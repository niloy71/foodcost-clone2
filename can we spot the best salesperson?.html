<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.340">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>foodcosts - Add more features</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="foodcosts - Add more features">
<meta property="og:image" content="https://fonteyne.github.io/foodcosts/Can we spot the best salesperson?_files/figure-html/cell-71-output-1.svg">
<meta property="og:site-name" content="foodcosts">
<meta name="twitter:title" content="foodcosts - Add more features">
<meta name="twitter:image" content="https://fonteyne.github.io/foodcosts/Can we spot the best salesperson?_files/figure-html/cell-71-output-1.svg">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">foodcosts</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./can we spot the best salesperson?.html">Add more features</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">foodcosts</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">core</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Average foodcost per revenue for shops and RE.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Average foodcost per revenue for shops and RE.html</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./can we spot the best salesperson?.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Add more features</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Corporate restaurants unit economics including wages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Corporate restaurants unit economics including wages.html</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./day dashboard.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Shop LATEM</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./re wpp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">WPP products solds last n days</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./salad bar &amp; hotbar sales in latem &amp; overijse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">what is selling the best salad bar or hotbar in Latem?</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Shop unit economics including wages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Shop unit economics including wages.html</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ventes RE hotbars &amp; other.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ventes RE hotbars &amp; other.html</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Vraag guy ivm winkels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vraag guy ivm winkels.html</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./automatic-daily-report.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">automatic-daily-report.html</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./best_selling_products.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">best_selling_products.html</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./events_made_in_shop_and_re.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">events_made_in_shop_and_re.html</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./food_costs_simplified_code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">the parameters to set</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fruit_basket.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">fruit_basket.html</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nbr_days_unsold_products_in_latem.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">nbr_days_unsold_products_in_latem.html</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pavlova_bar.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">pavlova_bar.html</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sales pavlova bar.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">WPP products solds last n days</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sales_initiatives_latem.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chocolate mousses</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./shop_unit_economics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">shop_unit_economics.html</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./should we open the corporate restaurants on the friday after a public holiday?.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Should we open the corporate restaurant the Friday after a public holiday?</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stock outs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">stock outs.html</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#training" id="toc-training" class="nav-link active" data-scroll-target="#training">training</a></li>
  <li><a href="#using-a-decision-tree" id="toc-using-a-decision-tree" class="nav-link" data-scroll-target="#using-a-decision-tree">using a decision tree</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/fonteyne/foodcosts/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Add more features</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>sys.path.append(<span class="st">".."</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> foodcosts.core <span class="im">as</span> core</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> calendar</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastbook <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> date</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastai.tabular.core <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas.api.types <span class="im">import</span> is_string_dtype, is_numeric_dtype, is_categorical_dtype</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastai.tabular.<span class="bu">all</span> <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeRegressor</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dtreeviz.trees <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Image, display_svg, SVG</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>pd.options.display.max_rows <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>pd.options.display.max_columns <span class="op">=</span> <span class="dv">8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_hours_worked_for_a_shop_for_a_period(warehouse_id, start_yyyy_mm_dd, end_yyyy_mm_dd):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> <span class="st">"https://formation.fthek.be/api/v2/hours_worked/period"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    body <span class="op">=</span> {</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"warehouse_id"</span>: warehouse_id,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"start_yyyy_mm_dd"</span>: start_yyyy_mm_dd,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"end_yyyy_mm_dd"</span>: end_yyyy_mm_dd</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.get(url, json<span class="op">=</span>body)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(response.status_code)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> response.json()</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(response)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get hours worked for march 2023 for Chatelain</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> get_hours_worked_for_a_shop_for_a_period(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    warehouse_id<span class="op">=</span><span class="dv">12</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    start_yyyy_mm_dd<span class="op">=</span><span class="st">"2023-03-01"</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    end_yyyy_mm_dd<span class="op">=</span><span class="st">"2023-03-02"</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>200
[{'hoursWorked': 11.06666666666667, 'employee': 'Bram DE KEYSER', 'date': '2023-03-02T23:00:00.000Z', 'warehouseId': 12}, {'hoursWorked': 11.18333333333333, 'employee': 'Marine JANSSENS', 'date': '2023-03-01T23:00:00.000Z', 'warehouseId': 12}, {'hoursWorked': 10.95, 'employee': 'Fernando HERNANDEZ GUARDADO', 'date': '2023-03-02T23:00:00.000Z', 'warehouseId': 12}, {'hoursWorked': 11.18333333333333, 'employee': 'Paul GUERRERO', 'date': '2023-03-01T23:00:00.000Z', 'warehouseId': 12}, {'hoursWorked': 11.03333333333333, 'employee': 'Paul GUERRERO', 'date': '2023-03-02T23:00:00.000Z', 'warehouseId': 12}]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>shops <span class="op">=</span> [( core.get_shop_id(shop_name), shop_name ) <span class="cf">for</span> shop_name <span class="kw">in</span> core.get_shop_names()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>config.ini file available... using that
config.ini file available... using that
config.ini file available... using that
config.ini file available... using that
config.ini file available... using that
config.ini file available... using that
config.ini file available... using that
config.ini file available... using that
config.ini file available... using that</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>shops</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[(2, 'La Hulpe'),
 (3, 'Fort Jaco'),
 (4, 'Woluwe'),
 (6, 'Tongres'),
 (7, 'Wemmel'),
 (12, 'CHATELAIN'),
 (36, 'OVERIJSE'),
 (39, 'LATEM')]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># imports</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> date</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> calendar</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># returns list of date strings in yyyy_mm_dd format</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_dates_in_month(month, year):</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [date(year, month, day).strftime(<span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">"</span>) <span class="cf">for</span> day <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, calendar.monthrange(year, month)[<span class="dv">1</span>] <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>get_dates_in_month(<span class="dv">3</span>,<span class="dv">2023</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['2023-03-01',
 '2023-03-02',
 '2023-03-03',
 '2023-03-04',
 '2023-03-05',
 '2023-03-06',
 '2023-03-07',
 '2023-03-08',
 '2023-03-09',
 '2023-03-10',
 '2023-03-11',
 '2023-03-12',
 '2023-03-13',
 '2023-03-14',
 '2023-03-15',
 '2023-03-16',
 '2023-03-17',
 '2023-03-18',
 '2023-03-19',
 '2023-03-20',
 '2023-03-21',
 '2023-03-22',
 '2023-03-23',
 '2023-03-24',
 '2023-03-25',
 '2023-03-26',
 '2023-03-27',
 '2023-03-28',
 '2023-03-29',
 '2023-03-30',
 '2023-03-31']</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>core.get_shop_names()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>config.ini file available... using that</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>['La Hulpe',
 'Fort Jaco',
 'Woluwe',
 'Tongres',
 'Wemmel',
 'CHATELAIN',
 'OVERIJSE',
 'LATEM']</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># interested_shops = [(4, 'Woluwe'),  (12, 'CHATELAIN')]</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>interested_shops <span class="op">=</span> [</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    (</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    core.get_shop_id(name),</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    name </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="cf">for</span> name <span class="kw">in</span> core.get_shop_names()</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>config.ini file available... using that
config.ini file available... using that
config.ini file available... using that
config.ini file available... using that
config.ini file available... using that
config.ini file available... using that
config.ini file available... using that
config.ini file available... using that
config.ini file available... using that</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>core.get_sales_for_period_for_shop_per_day(<span class="st">"2023-01-01"</span>, <span class="st">"2023-03-31"</span>, <span class="st">"Woluwe"</span>).head(<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>config.ini file available... using that</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">shop_name</th>
<th data-quarto-table-cell-role="th">day</th>
<th data-quarto-table-cell-role="th">total_sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Woluwe</td>
<td>2023-01-02</td>
<td>2943.39616</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Woluwe</td>
<td>2023-01-03</td>
<td>2850.73890</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Woluwe</td>
<td>2023-01-04</td>
<td>3917.95500</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Woluwe</td>
<td>2023-01-05</td>
<td>3937.68200</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_data_table(dates, shops):</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    min_date <span class="op">=</span> <span class="bu">min</span>(dates)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    max_date <span class="op">=</span> <span class="bu">max</span>(dates)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># data frame shop_sales</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    shop_sales <span class="op">=</span> pd.DataFrame() </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    shop_hours <span class="op">=</span> pd.DataFrame()</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">id</span>, name <span class="kw">in</span> shops:</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>        sales <span class="op">=</span> core.get_sales_for_period_for_shop_per_day(min_date, max_date, name)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>        sales[<span class="st">"warehouseId"</span>] <span class="op">=</span> <span class="bu">id</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>        shop_sales <span class="op">=</span> shop_sales.append(sales, ignore_index<span class="op">=</span><span class="va">True</span>) </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        hours <span class="op">=</span> get_hours_worked_for_a_shop_for_a_period(<span class="bu">id</span>, min_date, max_date)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        shop_hours <span class="op">=</span> shop_hours.append(hours, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> shop_hours, shop_sales</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># using get_dates_in_month, return a list of all dates in the first quarter of 2023</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>all_dates <span class="op">=</span> [</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    date <span class="cf">for</span> month <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">4</span>) <span class="cf">for</span> date <span class="kw">in</span> get_dates_in_month(month, <span class="dv">2023</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>all_dates</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['2023-01-01',
 '2023-01-02',
 '2023-01-03',
 '2023-01-04',
 '2023-01-05',
 '2023-01-06',
 '2023-01-07',
 '2023-01-08',
 '2023-01-09',
 '2023-01-10',
 '2023-01-11',
 '2023-01-12',
 '2023-01-13',
 '2023-01-14',
 '2023-01-15',
 '2023-01-16',
 '2023-01-17',
 '2023-01-18',
 '2023-01-19',
 '2023-01-20',
 '2023-01-21',
 '2023-01-22',
 '2023-01-23',
 '2023-01-24',
 '2023-01-25',
 '2023-01-26',
 '2023-01-27',
 '2023-01-28',
 '2023-01-29',
 '2023-01-30',
 '2023-01-31',
 '2023-02-01',
 '2023-02-02',
 '2023-02-03',
 '2023-02-04',
 '2023-02-05',
 '2023-02-06',
 '2023-02-07',
 '2023-02-08',
 '2023-02-09',
 '2023-02-10',
 '2023-02-11',
 '2023-02-12',
 '2023-02-13',
 '2023-02-14',
 '2023-02-15',
 '2023-02-16',
 '2023-02-17',
 '2023-02-18',
 '2023-02-19',
 '2023-02-20',
 '2023-02-21',
 '2023-02-22',
 '2023-02-23',
 '2023-02-24',
 '2023-02-25',
 '2023-02-26',
 '2023-02-27',
 '2023-02-28',
 '2023-03-01',
 '2023-03-02',
 '2023-03-03',
 '2023-03-04',
 '2023-03-05',
 '2023-03-06',
 '2023-03-07',
 '2023-03-08',
 '2023-03-09',
 '2023-03-10',
 '2023-03-11',
 '2023-03-12',
 '2023-03-13',
 '2023-03-14',
 '2023-03-15',
 '2023-03-16',
 '2023-03-17',
 '2023-03-18',
 '2023-03-19',
 '2023-03-20',
 '2023-03-21',
 '2023-03-22',
 '2023-03-23',
 '2023-03-24',
 '2023-03-25',
 '2023-03-26',
 '2023-03-27',
 '2023-03-28',
 '2023-03-29',
 '2023-03-30',
 '2023-03-31']</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>hours_df, sales_df <span class="op">=</span> get_data_table(all_dates, interested_shops)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>config.ini file available... using that
200
config.ini file available... using that
200
config.ini file available... using that
200
config.ini file available... using that
400
&lt;Response [400]&gt;
config.ini file available... using that
200
config.ini file available... using that
200
config.ini file available... using that
200
config.ini file available... using that
200</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert day to string %Y-%m-%d</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># sales_df["day"] = sales_df["day"].apply(lambda x: x.strftime("%Y-%m-%d"))</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>sales_df.head().iloc[<span class="dv">0</span>].day</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>datetime.date(2023, 1, 2)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>hours_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">hoursWorked</th>
<th data-quarto-table-cell-role="th">employee</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">warehouseId</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>10.466667</td>
<td>Maxime VANHAMME</td>
<td>2023-01-01T22:59:59.999Z</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>10.383333</td>
<td>Kevin BETTE</td>
<td>2023-01-01T22:59:59.999Z</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>5.750000</td>
<td>Massimo OLIVO</td>
<td>2023-01-01T22:59:59.999Z</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7.016667</td>
<td>Annabelle GATHY</td>
<td>2023-01-01T22:59:59.999Z</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>7.016667</td>
<td>Léa VAN DEN HOUTE</td>
<td>2023-01-01T22:59:59.999Z</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1804</td>
<td>7.083333</td>
<td>Lies VERSTRAETEN</td>
<td>2023-01-06T23:00:00.000Z</td>
<td>39</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1805</td>
<td>4.566667</td>
<td>Lies VERSTRAETEN</td>
<td>2023-01-07T23:00:00.000Z</td>
<td>39</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1806</td>
<td>5.166667</td>
<td>Lies VERSTRAETEN</td>
<td>2023-01-13T23:00:00.000Z</td>
<td>39</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1807</td>
<td>5.116667</td>
<td>Lies VERSTRAETEN</td>
<td>2023-01-20T23:00:00.000Z</td>
<td>39</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1808</td>
<td>5.116667</td>
<td>Lies VERSTRAETEN</td>
<td>2023-01-27T23:00:00.000Z</td>
<td>39</td>
</tr>
</tbody>
</table>

<p>1809 rows × 4 columns</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>hours_df.employee.unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array(['Maxime VANHAMME', 'Kevin BETTE', 'Massimo OLIVO',
       'Annabelle GATHY', 'Léa VAN DEN HOUTE', 'Inès DACY',
       'Khalil BOUMESHED', 'Savina RAJANAH', 'Vincenzo LO GATTO',
       'Maximilien MICHIELS', 'Shahine BANDALI', 'Aurelie MARIVOET',
       'Tito RODRIGUEZ AMAYA', 'Benjamin MOENECLAEY',
       'Carlos AZUCINA RECINA', 'Armel KANDJEU', 'Luca BORGO',
       'Grace EBELLE', 'Renaud LECOMTE', 'Ana DE OLIVEIRA CARREIRA',
       'Diana ARBELAEZ CORREA', 'Nadine DEBROUX', 'Anne LIPPENS',
       'Myriam VANDERHAEGEN', 'Armando APARICIO PEREZ', 'Ronny BERT',
       'Thomas MOT', 'Esther ZHU', 'Charlotte SNEYERS', 'Guy MAWETE',
       'Kris GALOPPIN', 'Aubin KANDJEU', 'Nicolas QUERTINMONT',
       'Sanne DE LOOSE', 'Jelle ERAERTS', 'Makane',
       'Christian BOURGUIGNON', 'Justine CORNET', 'Pauline POSOCCO',
       'Jawhara TAMRI', 'Bram DE KEYSER', 'Marine JANSSENS',
       'Fernando HERNANDEZ GUARDADO', 'Paul GUERRERO', 'Fatou YARA',
       'Ricardo GUERRERO', 'Johan VAN GUCHT', 'Cécile BOLSAIE',
       'Kathy REGELBRUGGE', 'Giorgio LAMAGNO', 'Jaya DE SCHEPPER',
       'Hubert VAN STRIEN', 'Mathis DENIS', 'Alessandra CHIANALE',
       'Olivier HEES', 'Jules DE WITTE', 'Alix VERSTRAETEN',
       'Michel WOUTERS', 'Carine VERCRAYE', 'Sylvie DE MEYER',
       'Roos VANDEKERCKHOVE', 'Britt JOORIS', 'Stefanie VERMEERSCH',
       'Cato DE SLOOVERE', 'Anna SCHEPENS', 'Ella DE GRAEVE',
       'Lies VERSTRAETEN', 'Anne-Laure VERWEE', 'Linde',
       'Charlotte DE LANGE', 'Wout VERSTRAEYEN', 'Lisa DE BRUYKER CHABBA'],
      dtype=object)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>hours_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">hoursWorked</th>
<th data-quarto-table-cell-role="th">employee</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">warehouseId</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>10.466667</td>
<td>Maxime VANHAMME</td>
<td>2023-01-01T22:59:59.999Z</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>10.383333</td>
<td>Kevin BETTE</td>
<td>2023-01-01T22:59:59.999Z</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>5.750000</td>
<td>Massimo OLIVO</td>
<td>2023-01-01T22:59:59.999Z</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7.016667</td>
<td>Annabelle GATHY</td>
<td>2023-01-01T22:59:59.999Z</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>7.016667</td>
<td>Léa VAN DEN HOUTE</td>
<td>2023-01-01T22:59:59.999Z</td>
<td>2</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>pivoted_hours_df <span class="op">=</span> hours_df.pivot_table(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span><span class="st">"employee"</span>,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>[<span class="st">"warehouseId"</span>, <span class="st">"date"</span>],</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    values<span class="op">=</span><span class="st">"hoursWorked"</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    fill_value<span class="op">=</span><span class="dv">0</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>pivoted_hours_df.reset_index(inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add column called date_label</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># pivoted_hours_df["date_label"] = pivoted_hours_df["date"].apply(lambda x: x.strftime("%Y-%m-%d"))</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>pivoted_hours_df[<span class="st">"day"</span>] <span class="op">=</span> pd.to_datetime(pivoted_hours_df.date).<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.strftime(<span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>sales_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">shop_name</th>
<th data-quarto-table-cell-role="th">day</th>
<th data-quarto-table-cell-role="th">total_sales</th>
<th data-quarto-table-cell-role="th">warehouseId</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>La Hulpe</td>
<td>2023-01-02</td>
<td>1732.00586</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>La Hulpe</td>
<td>2023-01-03</td>
<td>1715.98970</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>La Hulpe</td>
<td>2023-01-04</td>
<td>2034.67742</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>La Hulpe</td>
<td>2023-01-05</td>
<td>1319.44470</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>La Hulpe</td>
<td>2023-01-06</td>
<td>1337.52960</td>
<td>2</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>sales_df.head().iloc[<span class="dv">0</span>].day</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>datetime.date(2023, 1, 2)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>pivoted_hours_df.head()</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># sales_df.head()[["warehouseId", "day"]].iloc[0].day</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">employee</th>
<th data-quarto-table-cell-role="th">warehouseId</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">Alessandra CHIANALE</th>
<th data-quarto-table-cell-role="th">Alix VERSTRAETEN</th>
<th data-quarto-table-cell-role="th">Ana DE OLIVEIRA CARREIRA</th>
<th data-quarto-table-cell-role="th">Anna SCHEPENS</th>
<th data-quarto-table-cell-role="th">Annabelle GATHY</th>
<th data-quarto-table-cell-role="th">Anne LIPPENS</th>
<th data-quarto-table-cell-role="th">Anne-Laure VERWEE</th>
<th data-quarto-table-cell-role="th">Armando APARICIO PEREZ</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Sanne DE LOOSE</th>
<th data-quarto-table-cell-role="th">Savina RAJANAH</th>
<th data-quarto-table-cell-role="th">Shahine BANDALI</th>
<th data-quarto-table-cell-role="th">Stefanie VERMEERSCH</th>
<th data-quarto-table-cell-role="th">Sylvie DE MEYER</th>
<th data-quarto-table-cell-role="th">Thomas MOT</th>
<th data-quarto-table-cell-role="th">Tito RODRIGUEZ AMAYA</th>
<th data-quarto-table-cell-role="th">Vincenzo LO GATTO</th>
<th data-quarto-table-cell-role="th">Wout VERSTRAEYEN</th>
<th data-quarto-table-cell-role="th">day</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2</td>
<td>2023-01-01T22:59:59.999Z</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>7.016667</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>2023-01-01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>2023-01-01T23:00:00.000Z</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>2023-01-01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2</td>
<td>2023-01-02T23:00:00.000Z</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>2023-01-02</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2</td>
<td>2023-01-03T23:00:00.000Z</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>2023-01-03</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2</td>
<td>2023-01-04T23:00:00.000Z</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>2023-01-04</td>
</tr>
</tbody>
</table>

<p>5 rows × 75 columns</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>sales_df[<span class="st">"date"</span>] <span class="op">=</span> sales_df.day</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>sales_df[<span class="st">"day"</span>] <span class="op">=</span> pd.to_datetime(sales_df.day).<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.strftime(<span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">"</span>))</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># sales_df.iloc[0]</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co">#result = pd.merge(pivoted_hours_df, sales_df, on=['warehouseId', 'day'])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>merged_res <span class="op">=</span> pd.merge(</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    sales_df, </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    pivoted_hours_df, </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span>[</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'warehouseId'</span>, </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">'day'</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>merged_res.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">shop_name</th>
<th data-quarto-table-cell-role="th">day</th>
<th data-quarto-table-cell-role="th">total_sales</th>
<th data-quarto-table-cell-role="th">warehouseId</th>
<th data-quarto-table-cell-role="th">date_x</th>
<th data-quarto-table-cell-role="th">date_y</th>
<th data-quarto-table-cell-role="th">Alessandra CHIANALE</th>
<th data-quarto-table-cell-role="th">Alix VERSTRAETEN</th>
<th data-quarto-table-cell-role="th">Ana DE OLIVEIRA CARREIRA</th>
<th data-quarto-table-cell-role="th">Anna SCHEPENS</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Roos VANDEKERCKHOVE</th>
<th data-quarto-table-cell-role="th">Sanne DE LOOSE</th>
<th data-quarto-table-cell-role="th">Savina RAJANAH</th>
<th data-quarto-table-cell-role="th">Shahine BANDALI</th>
<th data-quarto-table-cell-role="th">Stefanie VERMEERSCH</th>
<th data-quarto-table-cell-role="th">Sylvie DE MEYER</th>
<th data-quarto-table-cell-role="th">Thomas MOT</th>
<th data-quarto-table-cell-role="th">Tito RODRIGUEZ AMAYA</th>
<th data-quarto-table-cell-role="th">Vincenzo LO GATTO</th>
<th data-quarto-table-cell-role="th">Wout VERSTRAEYEN</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>La Hulpe</td>
<td>2023-01-02</td>
<td>1732.00586</td>
<td>2</td>
<td>2023-01-02</td>
<td>2023-01-02T23:00:00.000Z</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>La Hulpe</td>
<td>2023-01-03</td>
<td>1715.98970</td>
<td>2</td>
<td>2023-01-03</td>
<td>2023-01-03T23:00:00.000Z</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>La Hulpe</td>
<td>2023-01-04</td>
<td>2034.67742</td>
<td>2</td>
<td>2023-01-04</td>
<td>2023-01-04T23:00:00.000Z</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>La Hulpe</td>
<td>2023-01-05</td>
<td>1319.44470</td>
<td>2</td>
<td>2023-01-05</td>
<td>2023-01-05T23:00:00.000Z</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>La Hulpe</td>
<td>2023-01-06</td>
<td>1337.52960</td>
<td>2</td>
<td>2023-01-06</td>
<td>2023-01-06T23:00:00.000Z</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>5 rows × 78 columns</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import add_datepart from fastai</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># drop column date</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_features(df):</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add column day of the week (i.e. mon, tue, wed, etc.)</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    add_datepart(df,  <span class="st">"day"</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># df["day_of_week"] = pd.to_datetime(df.day).apply(lambda x: x.strftime("%A"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test():</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> sales_df.copy()</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    add_features(df)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(df)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>test()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  shop_name         day  total_sales  warehouseId        date
0  La Hulpe  2023-01-02   1732.00586            2  2023-01-02
1  La Hulpe  2023-01-03   1715.98970            2  2023-01-03
    shop_name  total_sales  warehouseId        date  dayYear  dayMonth  \
0    La Hulpe   1732.00586            2  2023-01-02     2023         1   
1    La Hulpe   1715.98970            2  2023-01-03     2023         1   
2    La Hulpe   2034.67742            2  2023-01-04     2023         1   
3    La Hulpe   1319.44470            2  2023-01-05     2023         1   
4    La Hulpe   1337.52960            2  2023-01-06     2023         1   
..        ...          ...          ...         ...      ...       ...   
699     LATEM   2584.94780           39  2023-03-26     2023         3   
700     LATEM   1516.20070           39  2023-03-27     2023         3   
701     LATEM   1623.17946           39  2023-03-28     2023         3   
702     LATEM   2472.40770           39  2023-03-29     2023         3   
703     LATEM   2767.07640           39  2023-03-30     2023         3   

     dayWeek  dayDay  dayDayofweek  dayDayofyear  dayIs_month_end  \
0          1       2             0             2            False   
1          1       3             1             3            False   
2          1       4             2             4            False   
3          1       5             3             5            False   
4          1       6             4             6            False   
..       ...     ...           ...           ...              ...   
699       12      26             6            85            False   
700       13      27             0            86            False   
701       13      28             1            87            False   
702       13      29             2            88            False   
703       13      30             3            89            False   

     dayIs_month_start  dayIs_quarter_end  dayIs_quarter_start  \
0                False              False                False   
1                False              False                False   
2                False              False                False   
3                False              False                False   
4                False              False                False   
..                 ...                ...                  ...   
699              False              False                False   
700              False              False                False   
701              False              False                False   
702              False              False                False   
703              False              False                False   

     dayIs_year_end  dayIs_year_start    dayElapsed  
0             False             False  1.672618e+09  
1             False             False  1.672704e+09  
2             False             False  1.672790e+09  
3             False             False  1.672877e+09  
4             False             False  1.672963e+09  
..              ...               ...           ...  
699           False             False  1.679789e+09  
700           False             False  1.679875e+09  
701           False             False  1.679962e+09  
702           False             False  1.680048e+09  
703           False             False  1.680134e+09  

[704 rows x 17 columns]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>add_features(merged_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>KeyError: 'day'</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>merged_res.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">shop_name</th>
<th data-quarto-table-cell-role="th">total_sales</th>
<th data-quarto-table-cell-role="th">warehouseId</th>
<th data-quarto-table-cell-role="th">date_x</th>
<th data-quarto-table-cell-role="th">date_y</th>
<th data-quarto-table-cell-role="th">Alessandra CHIANALE</th>
<th data-quarto-table-cell-role="th">Alix VERSTRAETEN</th>
<th data-quarto-table-cell-role="th">Ana DE OLIVEIRA CARREIRA</th>
<th data-quarto-table-cell-role="th">Anna SCHEPENS</th>
<th data-quarto-table-cell-role="th">Annabelle GATHY</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">dayDay</th>
<th data-quarto-table-cell-role="th">dayDayofweek</th>
<th data-quarto-table-cell-role="th">dayDayofyear</th>
<th data-quarto-table-cell-role="th">dayIs_month_end</th>
<th data-quarto-table-cell-role="th">dayIs_month_start</th>
<th data-quarto-table-cell-role="th">dayIs_quarter_end</th>
<th data-quarto-table-cell-role="th">dayIs_quarter_start</th>
<th data-quarto-table-cell-role="th">dayIs_year_end</th>
<th data-quarto-table-cell-role="th">dayIs_year_start</th>
<th data-quarto-table-cell-role="th">dayElapsed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>La Hulpe</td>
<td>1732.00586</td>
<td>2</td>
<td>2023-01-02</td>
<td>2023-01-02T23:00:00.000Z</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>1.672618e+09</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>La Hulpe</td>
<td>1715.98970</td>
<td>2</td>
<td>2023-01-03</td>
<td>2023-01-03T23:00:00.000Z</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>3</td>
<td>1</td>
<td>3</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>1.672704e+09</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>La Hulpe</td>
<td>2034.67742</td>
<td>2</td>
<td>2023-01-04</td>
<td>2023-01-04T23:00:00.000Z</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>4</td>
<td>2</td>
<td>4</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>1.672790e+09</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>La Hulpe</td>
<td>1319.44470</td>
<td>2</td>
<td>2023-01-05</td>
<td>2023-01-05T23:00:00.000Z</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>5</td>
<td>3</td>
<td>5</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>1.672877e+09</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>La Hulpe</td>
<td>1337.52960</td>
<td>2</td>
<td>2023-01-06</td>
<td>2023-01-06T23:00:00.000Z</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>6</td>
<td>4</td>
<td>6</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>1.672963e+09</td>
</tr>
</tbody>
</table>

<p>5 rows × 90 columns</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove warehouseId from merged_res</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>merged_res.drop(columns<span class="op">=</span>[<span class="st">"warehouseId"</span>,<span class="st">"day"</span>, <span class="st">"date_x"</span>, <span class="st">"date_y"</span>], inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>merged_res.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">shop_name</th>
<th data-quarto-table-cell-role="th">total_sales</th>
<th data-quarto-table-cell-role="th">Alessandra CHIANALE</th>
<th data-quarto-table-cell-role="th">Alix VERSTRAETEN</th>
<th data-quarto-table-cell-role="th">Ana DE OLIVEIRA CARREIRA</th>
<th data-quarto-table-cell-role="th">Anna SCHEPENS</th>
<th data-quarto-table-cell-role="th">Annabelle GATHY</th>
<th data-quarto-table-cell-role="th">Anne LIPPENS</th>
<th data-quarto-table-cell-role="th">Anne-Laure VERWEE</th>
<th data-quarto-table-cell-role="th">Armando APARICIO PEREZ</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Sanne DE LOOSE</th>
<th data-quarto-table-cell-role="th">Savina RAJANAH</th>
<th data-quarto-table-cell-role="th">Shahine BANDALI</th>
<th data-quarto-table-cell-role="th">Stefanie VERMEERSCH</th>
<th data-quarto-table-cell-role="th">Sylvie DE MEYER</th>
<th data-quarto-table-cell-role="th">Thomas MOT</th>
<th data-quarto-table-cell-role="th">Tito RODRIGUEZ AMAYA</th>
<th data-quarto-table-cell-role="th">Vincenzo LO GATTO</th>
<th data-quarto-table-cell-role="th">Wout VERSTRAEYEN</th>
<th data-quarto-table-cell-role="th">day_of_week</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>La Hulpe</td>
<td>1732.01</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>...</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0</td>
<td>Monday</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>La Hulpe</td>
<td>1715.99</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>...</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0</td>
<td>Tuesday</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>La Hulpe</td>
<td>2034.68</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>...</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0</td>
<td>Wednesday</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>La Hulpe</td>
<td>1319.44</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>...</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0</td>
<td>Thursday</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>La Hulpe</td>
<td>1337.53</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>...</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0</td>
<td>Friday</td>
</tr>
</tbody>
</table>

<p>5 rows × 75 columns</p>
</div>
</div>
</div>
<section id="training" class="level1">
<h1>training</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>cat_names <span class="op">=</span> [<span class="st">"day_of_week"</span>, <span class="st">"shop_name"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get names of columns that are not in cat_names or not equal to total_sales</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>cont_names <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> merged_res.columns <span class="cf">if</span> col <span class="kw">not</span> <span class="kw">in</span> cat_names <span class="kw">and</span> col <span class="op">!=</span> <span class="st">"total_sales"</span>]</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>cont_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['Alessandra CHIANALE',
 'Alix VERSTRAETEN',
 'Ana DE OLIVEIRA CARREIRA',
 'Anna SCHEPENS',
 'Annabelle GATHY',
 'Anne LIPPENS',
 'Anne-Laure VERWEE',
 'Armando APARICIO PEREZ',
 'Armel KANDJEU',
 'Aubin KANDJEU',
 'Aurelie MARIVOET',
 'Benjamin MOENECLAEY',
 'Bram DE KEYSER',
 'Britt JOORIS',
 'Carine VERCRAYE',
 'Carlos AZUCINA RECINA',
 'Cato DE SLOOVERE',
 'Charlotte DE LANGE',
 'Charlotte SNEYERS',
 'Christian BOURGUIGNON',
 'Cécile BOLSAIE',
 'Diana ARBELAEZ CORREA',
 'Ella DE GRAEVE',
 'Esther ZHU',
 'Fatou YARA',
 'Fernando HERNANDEZ GUARDADO',
 'Giorgio LAMAGNO',
 'Grace EBELLE',
 'Guy MAWETE',
 'Hubert VAN STRIEN',
 'Inès DACY',
 'Jawhara TAMRI',
 'Jaya DE SCHEPPER',
 'Jelle ERAERTS',
 'Johan VAN GUCHT',
 'Jules DE WITTE',
 'Justine CORNET',
 'Kathy REGELBRUGGE',
 'Kevin BETTE',
 'Khalil BOUMESHED',
 'Kris GALOPPIN',
 'Lies VERSTRAETEN',
 'Linde',
 'Lisa DE BRUYKER CHABBA',
 'Luca BORGO',
 'Léa VAN DEN HOUTE',
 'Makane',
 'Marine JANSSENS',
 'Massimo OLIVO',
 'Mathis DENIS',
 'Maxime VANHAMME',
 'Maximilien MICHIELS',
 'Michel WOUTERS',
 'Myriam VANDERHAEGEN',
 'Nadine DEBROUX',
 'Nicolas QUERTINMONT',
 'Olivier HEES',
 'Paul GUERRERO',
 'Pauline POSOCCO',
 'Renaud LECOMTE',
 'Ricardo GUERRERO',
 'Ronny BERT',
 'Roos VANDEKERCKHOVE',
 'Sanne DE LOOSE',
 'Savina RAJANAH',
 'Shahine BANDALI',
 'Stefanie VERMEERSCH',
 'Sylvie DE MEYER',
 'Thomas MOT',
 'Tito RODRIGUEZ AMAYA',
 'Vincenzo LO GATTO',
 'Wout VERSTRAEYEN']</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.get_dummies(merged_res, columns<span class="op">=</span>cat_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">total_sales</th>
<th data-quarto-table-cell-role="th">Alessandra CHIANALE</th>
<th data-quarto-table-cell-role="th">Alix VERSTRAETEN</th>
<th data-quarto-table-cell-role="th">Ana DE OLIVEIRA CARREIRA</th>
<th data-quarto-table-cell-role="th">Anna SCHEPENS</th>
<th data-quarto-table-cell-role="th">Annabelle GATHY</th>
<th data-quarto-table-cell-role="th">Anne LIPPENS</th>
<th data-quarto-table-cell-role="th">Anne-Laure VERWEE</th>
<th data-quarto-table-cell-role="th">Armando APARICIO PEREZ</th>
<th data-quarto-table-cell-role="th">Armel KANDJEU</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">day_of_week_Thursday</th>
<th data-quarto-table-cell-role="th">day_of_week_Tuesday</th>
<th data-quarto-table-cell-role="th">day_of_week_Wednesday</th>
<th data-quarto-table-cell-role="th">shop_name_CHATELAIN</th>
<th data-quarto-table-cell-role="th">shop_name_Fort Jaco</th>
<th data-quarto-table-cell-role="th">shop_name_LATEM</th>
<th data-quarto-table-cell-role="th">shop_name_La Hulpe</th>
<th data-quarto-table-cell-role="th">shop_name_OVERIJSE</th>
<th data-quarto-table-cell-role="th">shop_name_Wemmel</th>
<th data-quarto-table-cell-role="th">shop_name_Woluwe</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1732.01</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1715.99</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>...</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2034.68</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1319.44</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>...</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1337.53</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>5 rows × 87 columns</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch <span class="im">import</span> tensor</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>t_dep <span class="op">=</span> tensor(df.total_sales.values, dtype<span class="op">=</span><span class="bu">float</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>indep_cols <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> df.columns <span class="cf">if</span> col <span class="kw">not</span> <span class="kw">in</span> cat_names <span class="kw">and</span> col <span class="op">!=</span> <span class="st">"total_sales"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>t_indep <span class="op">=</span> tensor(df[indep_cols].values, dtype<span class="op">=</span>torch.<span class="bu">float</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>t_indep</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([[0., 0., 0.,  ..., 0., 0., 0.],
        [0., 0., 0.,  ..., 0., 0., 0.],
        [0., 0., 0.,  ..., 0., 0., 0.],
        ...,
        [0., 0., 0.,  ..., 0., 0., 0.],
        [0., 0., 0.,  ..., 0., 0., 0.],
        [0., 0., 0.,  ..., 0., 0., 0.]])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>t_indep.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([599, 86])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>torch.manual_seed(<span class="dv">442</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>n_coeff <span class="op">=</span> t_indep.shape[<span class="dv">1</span>]</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>coeffs <span class="op">=</span> torch.rand(n_coeff)<span class="op">-</span><span class="fl">0.5</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>coeffs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([-0.4629,  0.1386,  0.2409, -0.2262, -0.2632, -0.3147,  0.4876,  0.3136,
         0.2799, -0.4392,  0.2103,  0.3625,  0.1722,  0.2324, -0.3575, -0.0010,
        -0.1833, -0.2411,  0.0489,  0.0866, -0.0534,  0.3132, -0.1487, -0.2551,
         0.3328,  0.1292,  0.2361, -0.2622,  0.4051, -0.2674, -0.2312,  0.1147,
         0.4072,  0.2834,  0.0835, -0.0504,  0.4354, -0.3408, -0.4552,  0.1447,
        -0.4648, -0.3039, -0.1297, -0.0850,  0.4682,  0.3973, -0.4849,  0.2098,
        -0.3018,  0.4185,  0.1089,  0.0791, -0.1708, -0.1882,  0.4861, -0.2534,
        -0.2502, -0.0770,  0.3336, -0.4975, -0.2561,  0.0892, -0.4670,  0.3725,
        -0.1095,  0.3443, -0.3448,  0.1112, -0.2866,  0.0245, -0.1640, -0.0845,
        -0.1318,  0.3686,  0.3743,  0.4772, -0.0329, -0.3076,  0.1449,  0.3728,
         0.1066, -0.1043, -0.4297, -0.0069, -0.2685,  0.2132])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>t_indep<span class="op">*</span>coeffs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([[-0., 0., 0.,  ..., -0., -0., 0.],
        [-0., 0., 0.,  ..., -0., -0., 0.],
        [-0., 0., 0.,  ..., -0., -0., 0.],
        ...,
        [-0., 0., 0.,  ..., -0., -0., 0.],
        [-0., 0., 0.,  ..., -0., -0., 0.],
        [-0., 0., 0.,  ..., -0., -0., 0.]])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>vals,indices <span class="op">=</span> t_indep.<span class="bu">max</span>(dim<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>t_indep <span class="op">=</span> t_indep <span class="op">/</span> vals</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>t_indep<span class="op">*</span>coeffs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([[-0., 0., 0.,  ..., -0., -0., 0.],
        [-0., 0., 0.,  ..., -0., -0., 0.],
        [-0., 0., 0.,  ..., -0., -0., 0.],
        ...,
        [-0., 0., 0.,  ..., -0., -0., 0.],
        [-0., 0., 0.,  ..., -0., -0., 0.],
        [-0., 0., 0.,  ..., -0., -0., 0.]])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> (t_indep<span class="op">*</span>coeffs).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>preds[:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([-0.5767, -1.2906, -0.5112, -0.5628, -0.6637, -0.6638, -0.4289, -0.5990,
        -1.3077, -0.7758])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>loss <span class="op">=</span> torch.<span class="bu">abs</span>(preds<span class="op">-</span>t_dep).mean()</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>loss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor(2931.7363, dtype=torch.float64)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calc_preds(coeffs, indeps): <span class="cf">return</span> (indeps<span class="op">*</span>coeffs).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calc_loss(coeffs, indeps, deps): <span class="cf">return</span> torch.<span class="bu">abs</span>(calc_preds(coeffs, indeps)<span class="op">-</span>deps).mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>coeffs.requires_grad_()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([-0.4629,  0.1386,  0.2409, -0.2262, -0.2632, -0.3147,  0.4876,  0.3136,
         0.2799, -0.4392,  0.2103,  0.3625,  0.1722,  0.2324, -0.3575, -0.0010,
        -0.1833, -0.2411,  0.0489,  0.0866, -0.0534,  0.3132, -0.1487, -0.2551,
         0.3328,  0.1292,  0.2361, -0.2622,  0.4051, -0.2674, -0.2312,  0.1147,
         0.4072,  0.2834,  0.0835, -0.0504,  0.4354, -0.3408, -0.4552,  0.1447,
        -0.4648, -0.3039, -0.1297, -0.0850,  0.4682,  0.3973, -0.4849,  0.2098,
        -0.3018,  0.4185,  0.1089,  0.0791, -0.1708, -0.1882,  0.4861, -0.2534,
        -0.2502, -0.0770,  0.3336, -0.4975, -0.2561,  0.0892, -0.4670,  0.3725,
        -0.1095,  0.3443, -0.3448,  0.1112, -0.2866,  0.0245, -0.1640, -0.0845,
        -0.1318,  0.3686,  0.3743,  0.4772, -0.0329, -0.3076,  0.1449,  0.3728,
         0.1066, -0.1043, -0.4297, -0.0069, -0.2685,  0.2132],
       requires_grad=True)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastai.data.transforms <span class="im">import</span> RandomSplitter</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>trn_split,val_split<span class="op">=</span>RandomSplitter(seed<span class="op">=</span><span class="dv">42</span>)(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>trn_indep,val_indep <span class="op">=</span> t_indep[trn_split],t_indep[val_split]</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>trn_dep,val_dep <span class="op">=</span> t_dep[trn_split],t_dep[val_split]</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(trn_indep),<span class="bu">len</span>(val_indep)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(480, 119)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update_coeffs(coeffs, lr):</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>    coeffs.sub_(coeffs.grad <span class="op">*</span> lr)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>    coeffs.grad.zero_()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> one_epoch(coeffs, lr):</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> calc_loss(coeffs, trn_indep, trn_dep)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    loss.backward()</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> torch.no_grad(): update_coeffs(coeffs, lr)</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>loss<span class="sc">:.3f}</span><span class="ss">"</span>, end<span class="op">=</span><span class="st">"; "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> init_coeffs(): <span class="cf">return</span> (torch.rand(n_coeff)<span class="op">-</span><span class="fl">0.5</span>).requires_grad_()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_model(epochs<span class="op">=</span><span class="dv">30</span>, lr<span class="op">=</span><span class="fl">0.01</span>):</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>    torch.manual_seed(<span class="dv">442</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>    coeffs <span class="op">=</span> init_coeffs()</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(epochs): one_epoch(coeffs, lr<span class="op">=</span>lr)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> coeffs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>coeffs <span class="op">=</span> train_model(<span class="dv">18</span>, lr<span class="op">=</span><span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2926.872; 2926.791; 2926.710; 2926.628; 2926.547; 2926.466; 2926.384; 2926.303; 2926.222; 2926.140; 2926.059; 2925.977; 2925.896; 2925.815; 2925.733; 2925.652; 2925.571; 2925.489; </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_coeffs(): </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(indep_cols, coeffs.requires_grad_(<span class="va">False</span>)))</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># sort by value from highest to lowest</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> {k: v <span class="cf">for</span> k, v <span class="kw">in</span> <span class="bu">sorted</span>(res.items(), key<span class="op">=</span><span class="kw">lambda</span> item: item[<span class="dv">1</span>], reverse<span class="op">=</span><span class="va">True</span>)}</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k,v <span class="kw">in</span> res.items(): <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>k<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>v<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>show_coeffs()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>day_of_week_Sunday: 1.017
shop_name_CHATELAIN: 0.935
day_of_week_Monday: 0.879
day_of_week_Saturday: 0.832
Nadine DEBROUX: 0.755
day_of_week_Wednesday: 0.670
shop_name_Woluwe: 0.656
Sanne DE LOOSE: 0.637
Luca BORGO: 0.632
shop_name_Fort Jaco: 0.594
Justine CORNET: 0.540
day_of_week_Thursday: 0.537
Diana ARBELAEZ CORREA: 0.535
shop_name_OVERIJSE: 0.533
Marine JANSSENS: 0.512
Benjamin MOENECLAEY: 0.510
Armando APARICIO PEREZ: 0.509
Anne-Laure VERWEE: 0.506
Mathis DENIS: 0.460
Léa VAN DEN HOUTE: 0.458
Guy MAWETE: 0.458
Jelle ERAERTS: 0.457
Jaya DE SCHEPPER: 0.432
Bram DE KEYSER: 0.431
shop_name_LATEM: 0.406
Fatou YARA: 0.393
Fernando HERNANDEZ GUARDADO: 0.392
Pauline POSOCCO: 0.372
day_of_week_Friday: 0.356
Shahine BANDALI: 0.352
Armel KANDJEU: 0.318
Maximilien MICHIELS: 0.308
Johan VAN GUCHT: 0.305
Khalil BOUMESHED: 0.291
Giorgio LAMAGNO: 0.284
Ana DE OLIVEIRA CARREIRA: 0.281
shop_name_Wemmel: 0.272
Sylvie DE MEYER: 0.271
Britt JOORIS: 0.265
Maxime VANHAMME: 0.262
Aurelie MARIVOET: 0.261
Tito RODRIGUEZ AMAYA: 0.254
Charlotte SNEYERS: 0.213
day_of_week_Tuesday: 0.202
Paul GUERRERO: 0.192
Alix VERSTRAETEN: 0.187
Ronny BERT: 0.149
Jawhara TAMRI: 0.122
Christian BOURGUIGNON: 0.104
Michel WOUTERS: 0.095
shop_name_La Hulpe: 0.088
Savina RAJANAH: 0.086
Vincenzo LO GATTO: 0.078
Carlos AZUCINA RECINA: 0.042
Olivier HEES: -0.003
Jules DE WITTE: -0.003
Hubert VAN STRIEN: -0.003
Cécile BOLSAIE: -0.020
Massimo OLIVO: -0.036
Nicolas QUERTINMONT: -0.057
Wout VERSTRAEYEN: -0.071
Lisa DE BRUYKER CHABBA: -0.071
Myriam VANDERHAEGEN: -0.100
Ella DE GRAEVE: -0.118
Linde: -0.122
Cato DE SLOOVERE: -0.156
Thomas MOT: -0.169
Anna SCHEPENS: -0.179
Anne LIPPENS: -0.180
Annabelle GATHY: -0.195
Kevin BETTE: -0.199
Charlotte DE LANGE: -0.214
Inès DACY: -0.224
Grace EBELLE: -0.242
Ricardo GUERRERO: -0.249
Esther ZHU: -0.255
Lies VERSTRAETEN: -0.255
Kathy REGELBRUGGE: -0.257
Alessandra CHIANALE: -0.261
Stefanie VERMEERSCH: -0.262
Aubin KANDJEU: -0.263
Roos VANDEKERCKHOVE: -0.301
Carine VERCRAYE: -0.318
Kris GALOPPIN: -0.391
Makane: -0.477
Renaud LECOMTE: -0.486</code></pre>
</div>
</div>
</section>
<section id="using-a-decision-tree" class="level1">
<h1>using a decision tree</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># merged_res.head()</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> merged_res.copy()</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="co"># log the total_sales</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>df1[<span class="st">"total_sales"</span>] <span class="op">=</span> np.log(df1[<span class="st">"total_sales"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>df1.drop([<span class="st">"date_x"</span>, <span class="st">"date_y"</span>], axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>df1.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Index(['shop_name', 'total_sales', 'warehouseId', 'Alessandra CHIANALE',
       'Alix VERSTRAETEN', 'Ana DE OLIVEIRA CARREIRA', 'Anna SCHEPENS',
       'Annabelle GATHY', 'Anne LIPPENS', 'Anne-Laure VERWEE',
       'Armando APARICIO PEREZ', 'Armel KANDJEU', 'Aubin KANDJEU',
       'Aurelie MARIVOET', 'Benjamin MOENECLAEY', 'Bram DE KEYSER',
       'Britt JOORIS', 'Carine VERCRAYE', 'Carlos AZUCINA RECINA',
       'Cato DE SLOOVERE', 'Charlotte DE LANGE', 'Charlotte SNEYERS',
       'Christian BOURGUIGNON', 'Cécile BOLSAIE', 'Diana ARBELAEZ CORREA',
       'Ella DE GRAEVE', 'Esther ZHU', 'Fatou YARA',
       'Fernando HERNANDEZ GUARDADO', 'Giorgio LAMAGNO', 'Grace EBELLE',
       'Guy MAWETE', 'Hubert VAN STRIEN', 'Inès DACY', 'Jawhara TAMRI',
       'Jaya DE SCHEPPER', 'Jelle ERAERTS', 'Johan VAN GUCHT',
       'Jules DE WITTE', 'Justine CORNET', 'Kathy REGELBRUGGE', 'Kevin BETTE',
       'Khalil BOUMESHED', 'Kris GALOPPIN', 'Lies VERSTRAETEN', 'Linde',
       'Lisa DE BRUYKER CHABBA', 'Luca BORGO', 'Léa VAN DEN HOUTE', 'Makane',
       'Marine JANSSENS', 'Massimo OLIVO', 'Mathis DENIS', 'Maxime VANHAMME',
       'Maximilien MICHIELS', 'Michel WOUTERS', 'Myriam VANDERHAEGEN',
       'Nadine DEBROUX', 'Nicolas QUERTINMONT', 'Olivier HEES',
       'Paul GUERRERO', 'Pauline POSOCCO', 'Renaud LECOMTE',
       'Ricardo GUERRERO', 'Ronny BERT', 'Roos VANDEKERCKHOVE',
       'Sanne DE LOOSE', 'Savina RAJANAH', 'Shahine BANDALI',
       'Stefanie VERMEERSCH', 'Sylvie DE MEYER', 'Thomas MOT',
       'Tito RODRIGUEZ AMAYA', 'Vincenzo LO GATTO', 'Wout VERSTRAEYEN',
       'dayYear', 'dayMonth', 'dayWeek', 'dayDay', 'dayDayofweek',
       'dayDayofyear', 'dayIs_month_end', 'dayIs_month_start',
       'dayIs_quarter_end', 'dayIs_quarter_start', 'dayIs_year_end',
       'dayIs_year_start', 'dayElapsed'],
      dtype='object')</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>dep_var <span class="op">=</span> <span class="st">"total_sales"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>procs <span class="op">=</span> [Categorify, FillMissing]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># split df1 in training and validation sets</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="co"># import RandomSplitter from fastai</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastai.data.transforms <span class="im">import</span> RandomSplitter, range_of</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>splits <span class="op">=</span> RandomSplitter(valid_pct<span class="op">=</span><span class="fl">0.2</span>, seed<span class="op">=</span><span class="dv">42</span>)(range_of(df1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>cont_vars, cat_vars <span class="op">=</span> cont_cat_split(df1, dep_var<span class="op">=</span>dep_var)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>cont_vars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['Alessandra CHIANALE',
 'Alix VERSTRAETEN',
 'Ana DE OLIVEIRA CARREIRA',
 'Anna SCHEPENS',
 'Annabelle GATHY',
 'Anne LIPPENS',
 'Anne-Laure VERWEE',
 'Armando APARICIO PEREZ',
 'Armel KANDJEU',
 'Aubin KANDJEU',
 'Aurelie MARIVOET',
 'Benjamin MOENECLAEY',
 'Bram DE KEYSER',
 'Britt JOORIS',
 'Carine VERCRAYE',
 'Carlos AZUCINA RECINA',
 'Cato DE SLOOVERE',
 'Charlotte DE LANGE',
 'Charlotte SNEYERS',
 'Christian BOURGUIGNON',
 'Cécile BOLSAIE',
 'Diana ARBELAEZ CORREA',
 'Ella DE GRAEVE',
 'Esther ZHU',
 'Fatou YARA',
 'Fernando HERNANDEZ GUARDADO',
 'Giorgio LAMAGNO',
 'Grace EBELLE',
 'Guy MAWETE',
 'Hubert VAN STRIEN',
 'Inès DACY',
 'Jaya DE SCHEPPER',
 'Jelle ERAERTS',
 'Johan VAN GUCHT',
 'Jules DE WITTE',
 'Justine CORNET',
 'Kathy REGELBRUGGE',
 'Kevin BETTE',
 'Khalil BOUMESHED',
 'Kris GALOPPIN',
 'Lies VERSTRAETEN',
 'Linde',
 'Luca BORGO',
 'Léa VAN DEN HOUTE',
 'Makane',
 'Marine JANSSENS',
 'Massimo OLIVO',
 'Mathis DENIS',
 'Maxime VANHAMME',
 'Maximilien MICHIELS',
 'Michel WOUTERS',
 'Myriam VANDERHAEGEN',
 'Nadine DEBROUX',
 'Nicolas QUERTINMONT',
 'Olivier HEES',
 'Paul GUERRERO',
 'Pauline POSOCCO',
 'Renaud LECOMTE',
 'Ricardo GUERRERO',
 'Ronny BERT',
 'Roos VANDEKERCKHOVE',
 'Sanne DE LOOSE',
 'Savina RAJANAH',
 'Shahine BANDALI',
 'Stefanie VERMEERSCH',
 'Sylvie DE MEYER',
 'Thomas MOT',
 'Tito RODRIGUEZ AMAYA',
 'Vincenzo LO GATTO',
 'dayDay',
 'dayDayofyear',
 'dayElapsed']</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>cat_vars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['shop_name',
 'warehouseId',
 'Jawhara TAMRI',
 'Lisa DE BRUYKER CHABBA',
 'Wout VERSTRAEYEN',
 'dayYear',
 'dayMonth',
 'dayWeek',
 'dayDayofweek',
 'dayIs_month_end',
 'dayIs_month_start',
 'dayIs_quarter_end',
 'dayIs_quarter_start',
 'dayIs_year_end',
 'dayIs_year_start']</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>to <span class="op">=</span> TabularPandas(</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>    df1, </span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>    procs<span class="op">=</span>[</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>    Categorify, </span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>    FillMissing, </span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>    Normalize</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>    cat_names<span class="op">=</span>cat_vars, <span class="co"># list of categorical column names</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>    cont_names<span class="op">=</span>cont_vars, <span class="co"># list of continuous column names</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>                   y_names<span class="op">=</span>dep_var,</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>                   splits<span class="op">=</span>splits)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(to.train),<span class="bu">len</span>(to.valid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(480, 119)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>to.show(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">shop_name</th>
<th data-quarto-table-cell-role="th">warehouseId</th>
<th data-quarto-table-cell-role="th">Jawhara TAMRI</th>
<th data-quarto-table-cell-role="th">Lisa DE BRUYKER CHABBA</th>
<th data-quarto-table-cell-role="th">Wout VERSTRAEYEN</th>
<th data-quarto-table-cell-role="th">dayYear</th>
<th data-quarto-table-cell-role="th">dayMonth</th>
<th data-quarto-table-cell-role="th">dayWeek</th>
<th data-quarto-table-cell-role="th">dayDayofweek</th>
<th data-quarto-table-cell-role="th">dayIs_month_end</th>
<th data-quarto-table-cell-role="th">dayIs_month_start</th>
<th data-quarto-table-cell-role="th">dayIs_quarter_end</th>
<th data-quarto-table-cell-role="th">dayIs_quarter_start</th>
<th data-quarto-table-cell-role="th">dayIs_year_end</th>
<th data-quarto-table-cell-role="th">dayIs_year_start</th>
<th data-quarto-table-cell-role="th">Alessandra CHIANALE</th>
<th data-quarto-table-cell-role="th">Alix VERSTRAETEN</th>
<th data-quarto-table-cell-role="th">Ana DE OLIVEIRA CARREIRA</th>
<th data-quarto-table-cell-role="th">Anna SCHEPENS</th>
<th data-quarto-table-cell-role="th">Annabelle GATHY</th>
<th data-quarto-table-cell-role="th">Anne LIPPENS</th>
<th data-quarto-table-cell-role="th">Anne-Laure VERWEE</th>
<th data-quarto-table-cell-role="th">Armando APARICIO PEREZ</th>
<th data-quarto-table-cell-role="th">Armel KANDJEU</th>
<th data-quarto-table-cell-role="th">Aubin KANDJEU</th>
<th data-quarto-table-cell-role="th">Aurelie MARIVOET</th>
<th data-quarto-table-cell-role="th">Benjamin MOENECLAEY</th>
<th data-quarto-table-cell-role="th">Bram DE KEYSER</th>
<th data-quarto-table-cell-role="th">Britt JOORIS</th>
<th data-quarto-table-cell-role="th">Carine VERCRAYE</th>
<th data-quarto-table-cell-role="th">Carlos AZUCINA RECINA</th>
<th data-quarto-table-cell-role="th">Cato DE SLOOVERE</th>
<th data-quarto-table-cell-role="th">Charlotte DE LANGE</th>
<th data-quarto-table-cell-role="th">Charlotte SNEYERS</th>
<th data-quarto-table-cell-role="th">Christian BOURGUIGNON</th>
<th data-quarto-table-cell-role="th">Cécile BOLSAIE</th>
<th data-quarto-table-cell-role="th">Diana ARBELAEZ CORREA</th>
<th data-quarto-table-cell-role="th">Ella DE GRAEVE</th>
<th data-quarto-table-cell-role="th">Esther ZHU</th>
<th data-quarto-table-cell-role="th">Fatou YARA</th>
<th data-quarto-table-cell-role="th">Fernando HERNANDEZ GUARDADO</th>
<th data-quarto-table-cell-role="th">Giorgio LAMAGNO</th>
<th data-quarto-table-cell-role="th">Grace EBELLE</th>
<th data-quarto-table-cell-role="th">Guy MAWETE</th>
<th data-quarto-table-cell-role="th">Hubert VAN STRIEN</th>
<th data-quarto-table-cell-role="th">Inès DACY</th>
<th data-quarto-table-cell-role="th">Jaya DE SCHEPPER</th>
<th data-quarto-table-cell-role="th">Jelle ERAERTS</th>
<th data-quarto-table-cell-role="th">Johan VAN GUCHT</th>
<th data-quarto-table-cell-role="th">Jules DE WITTE</th>
<th data-quarto-table-cell-role="th">Justine CORNET</th>
<th data-quarto-table-cell-role="th">Kathy REGELBRUGGE</th>
<th data-quarto-table-cell-role="th">Kevin BETTE</th>
<th data-quarto-table-cell-role="th">Khalil BOUMESHED</th>
<th data-quarto-table-cell-role="th">Kris GALOPPIN</th>
<th data-quarto-table-cell-role="th">Lies VERSTRAETEN</th>
<th data-quarto-table-cell-role="th">Linde</th>
<th data-quarto-table-cell-role="th">Luca BORGO</th>
<th data-quarto-table-cell-role="th">Léa VAN DEN HOUTE</th>
<th data-quarto-table-cell-role="th">Makane</th>
<th data-quarto-table-cell-role="th">Marine JANSSENS</th>
<th data-quarto-table-cell-role="th">Massimo OLIVO</th>
<th data-quarto-table-cell-role="th">Mathis DENIS</th>
<th data-quarto-table-cell-role="th">Maxime VANHAMME</th>
<th data-quarto-table-cell-role="th">Maximilien MICHIELS</th>
<th data-quarto-table-cell-role="th">Michel WOUTERS</th>
<th data-quarto-table-cell-role="th">Myriam VANDERHAEGEN</th>
<th data-quarto-table-cell-role="th">Nadine DEBROUX</th>
<th data-quarto-table-cell-role="th">Nicolas QUERTINMONT</th>
<th data-quarto-table-cell-role="th">Olivier HEES</th>
<th data-quarto-table-cell-role="th">Paul GUERRERO</th>
<th data-quarto-table-cell-role="th">Pauline POSOCCO</th>
<th data-quarto-table-cell-role="th">Renaud LECOMTE</th>
<th data-quarto-table-cell-role="th">Ricardo GUERRERO</th>
<th data-quarto-table-cell-role="th">Ronny BERT</th>
<th data-quarto-table-cell-role="th">Roos VANDEKERCKHOVE</th>
<th data-quarto-table-cell-role="th">Sanne DE LOOSE</th>
<th data-quarto-table-cell-role="th">Savina RAJANAH</th>
<th data-quarto-table-cell-role="th">Shahine BANDALI</th>
<th data-quarto-table-cell-role="th">Stefanie VERMEERSCH</th>
<th data-quarto-table-cell-role="th">Sylvie DE MEYER</th>
<th data-quarto-table-cell-role="th">Thomas MOT</th>
<th data-quarto-table-cell-role="th">Tito RODRIGUEZ AMAYA</th>
<th data-quarto-table-cell-role="th">Vincenzo LO GATTO</th>
<th data-quarto-table-cell-role="th">dayDay</th>
<th data-quarto-table-cell-role="th">dayDayofyear</th>
<th data-quarto-table-cell-role="th">dayElapsed</th>
<th data-quarto-table-cell-role="th">total_sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">587</td>
<td>LATEM</td>
<td>39</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2023</td>
<td>3</td>
<td>11</td>
<td>6</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>-1.110223e-16</td>
<td>-1.387779e-17</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>-5.551115e-17</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>-2.775558e-17</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>-1.110223e-16</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>10.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>-1.734723e-18</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>-1.387779e-17</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.000000e+01</td>
<td>1.110223e-16</td>
<td>1.110223e-16</td>
<td>0.0</td>
<td>1.833333</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>19.0</td>
<td>78.0</td>
<td>1.679184e+09</td>
<td>7.599734</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">42</td>
<td>La Hulpe</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2023</td>
<td>2</td>
<td>7</td>
<td>0</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>-1.110223e-16</td>
<td>-1.387779e-17</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>-5.551115e-17</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>-2.775558e-17</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>-1.110223e-16</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>11.183333</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>-1.734723e-18</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>10.766666</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>-1.387779e-17</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>5.551115e-17</td>
<td>1.110223e-16</td>
<td>1.110223e-16</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>13.0</td>
<td>44.0</td>
<td>1.676246e+09</td>
<td>7.676594</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">527</td>
<td>LATEM</td>
<td>39</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2023</td>
<td>1</td>
<td>3</td>
<td>2</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>-1.110223e-16</td>
<td>-1.387779e-17</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>-5.551115e-17</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>-2.775558e-17</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>-1.110223e-16</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>7.016667</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>-1.734723e-18</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>4.216667</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>-1.387779e-17</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>5.283333e+00</td>
<td>1.110223e-16</td>
<td>1.110223e-16</td>
<td>0.0</td>
<td>2.583333</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>18.0</td>
<td>18.0</td>
<td>1.674000e+09</td>
<td>7.540080</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>xs,y <span class="op">=</span> to.train.xs,to.train.y</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>valid_xs,valid_y <span class="op">=</span> to.valid.xs,to.valid.y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> DecisionTreeRegressor(</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>    max_depth<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>m.fit(xs, y)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>draw_tree(m, xs, size<span class="op">=</span><span class="dv">10</span>, leaves_parallel<span class="op">=</span><span class="va">True</span>, precision<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Can we spot the best salesperson?_files/figure-html/cell-71-output-1.svg" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rf(xs, y, n_estimators<span class="op">=</span><span class="dv">40</span>, max_samples<span class="op">=</span><span class="dv">200</span>,</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>       max_features<span class="op">=</span><span class="fl">0.5</span>, min_samples_leaf<span class="op">=</span><span class="dv">5</span>, <span class="op">**</span>kwargs):</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> RandomForestRegressor(n_jobs<span class="op">=-</span><span class="dv">1</span>, n_estimators<span class="op">=</span>n_estimators,</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>        max_samples<span class="op">=</span>max_samples, max_features<span class="op">=</span>max_features,</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>        min_samples_leaf<span class="op">=</span>min_samples_leaf, oob_score<span class="op">=</span><span class="va">True</span>).fit(xs, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> rf(xs, y)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> r_mse(pred,y): <span class="cf">return</span> <span class="bu">round</span>(math.sqrt(((pred<span class="op">-</span>y)<span class="op">**</span><span class="dv">2</span>).mean()), <span class="dv">6</span>)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> m_rmse(m, xs, y): <span class="cf">return</span> r_mse(m.predict(xs), y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>m_rmse(m, xs, y), m_rmse(m, valid_xs, valid_y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(0.212125, 0.231593)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>r_mse(m.oob_prediction_, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>0.242413</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rf_feat_importance(m, df):</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame({<span class="st">'cols'</span>:df.columns, <span class="st">'imp'</span>:m.feature_importances_}</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>                       ).sort_values(<span class="st">'imp'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>fi <span class="op">=</span> rf_feat_importance(m, xs)</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fi[:<span class="dv">10</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      cols       imp
0                shop_name  0.413651
8             dayDayofweek  0.230015
1              warehouseId  0.075169
67          Nadine DEBROUX  0.032762
85            dayDayofyear  0.022988
86              dayElapsed  0.020891
36   Diana ARBELAEZ CORREA  0.020645
22  Armando APARICIO PEREZ  0.016432
84                  dayDay  0.015929
60         Marine JANSSENS  0.013443</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fi[<span class="dv">10</span>:<span class="dv">20</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           cols       imp
64          Maximilien MICHIELS  0.012733
7                       dayWeek  0.012162
52                  Kevin BETTE  0.010867
40  Fernando HERNANDEZ GUARDADO  0.009706
69                 Olivier HEES  0.008153
61                Massimo OLIVO  0.007788
24                Aubin KANDJEU  0.006343
6                      dayMonth  0.005674
83            Vincenzo LO GATTO  0.005564
33            Charlotte SNEYERS  0.005515</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_fi(fi):</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fi.plot(<span class="st">'cols'</span>, <span class="st">'imp'</span>, <span class="st">'barh'</span>, figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">7</span>), legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>plot_fi(fi[:<span class="dv">30</span>])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Can we spot the best salesperson?_files/figure-html/cell-80-output-1.png" class="img-fluid"></p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>